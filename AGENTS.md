# PRD: 경쟁사 공고 데이터 자동 업데이트

## 1. 배경/현황
- GitHub Actions로 매주 월요일 경쟁사 공고를 크롤링해 CSV로 저장
- 공용 드라이브 업로드 후 Google Sheets로 변환
- 시트 내 함수로 가공된 결과를 바탕으로 `[사업운영팀]_경쟁사_히스토리`에 매주 1회 업데이트
- 수집 완료된 경쟁사 데이터는 총 6개이며, 각각 다른 시트 탭(제목 기준)에 수동으로 붙여넣기 수행

## 2. 목표
- 6개 경쟁사 데이터의 시트별 업데이트를 자동화
- 주 1회(월요일) 최신 데이터가 정확한 탭에 반영되도록 처리
- 실패 시 알림 및 재시도 가능한 운영 흐름 확보

## 3. 범위
### 포함
- 6개 경쟁사 데이터 → `[사업운영팀]_경쟁사_히스토리` 내 6개 탭 자동 매핑/업데이트
- 기존 GitHub Actions 기반 주간 크롤링 결과 활용
- CSV → GSheet 변환 이후 최종 업데이트 자동화

### 제외
- 크롤링 로직 개선
- 기존 시트 함수 로직 변경
- 다른 보고서/대시보드 연동

## 4. 현행 프로세스(AS-IS)
1. GitHub Actions가 월요일 크롤링 → CSV 생성
2. 공용 드라이브 업로드 → Google Sheets 변환
3. 시트 내 함수로 데이터 가공
4. 담당자가 6개 경쟁사 데이터를 탭 제목 기준으로 찾아 수동 업데이트

## 5. 문제점
- 탭 매핑 오류 가능성(오입력/누락)
- 작업 시간 소요 및 반복 부담
- 담당자 부재 시 업데이트 지연

## 6. 요구사항
### 기능 요구사항
1. 6개 경쟁사 데이터 파일(또는 시트)을 자동으로 인식
2. `[사업운영팀]_경쟁사_히스토리` 내부 탭 제목과 자동 매핑
3. 지정된 탭에 최신 데이터만 반영(기존 데이터 대체)
4. 실행 결과(성공/실패) 로깅
5. 기존 A~C열 데이터는 업데이트 전 삭제(교체 방식 전제)

### 비기능 요구사항
- 월요일 1회 자동 실행(크론/스케줄)
- Google Drive/Sheets 접근 권한 최소화
- 실패 시 재시도 또는 재실행 가능
- 변경 내역 감사 가능(로그, 버전 관리)

## 7. 데이터/매핑 정의
> 파일명 내 영문 접두어는 고정, 날짜/시간 문자열(예: 260126, 114640)은 매주 변동
> 아래 파일명은 스프레드시트 이름 기준이며, "(gsheet)" 표기는 파일명이 아님

| 경쟁사 데이터 ID | 입력 데이터 위치 | 대상 시트 탭명 | 업데이트 방식 |
| --- | --- | --- | --- |
| jumpit_* | `jumpit_YYMMDD_HHMMSS` 스프레드시트의 `시트1` B~D열 | `[사업운영팀]_경쟁사_히스토리`의 `점핏_추출` A~C열 | replace |
| jobko_onepick_* | `jobko_onepick_YYMMDD` 스프레드시트의 `시트1` B~D열 | `[사업운영팀]_경쟁사_히스토리`의 `원픽_추출` A~C열 | replace |
| saramin_headhunting_* | `saramin_headhunting_YYMMDD` 스프레드시트의 `시트1` B~D열 | `[사업운영팀]_경쟁사_히스토리`의 `스마트리쿠르터_추출` A~C열 | replace |
| remember_* | `remember_YYMMDD` 스프레드시트의 `시트1` B~D열 | `[사업운영팀]_경쟁사_히스토리`의 `리멤_추출` A~C열 | replace |
| saramin_* | `saramin_YYMMDD` 스프레드시트의 `시트1` B~D열 | `[사업운영팀]_경쟁사_히스토리`의 `사람인(일반)_추출` A~C열 | replace |

## 8. 동작 흐름(TO-BE)
1. GitHub Actions 스케줄 트리거(월요일)
2. 크롤링 결과 CSV 생성 및 Drive 업로드
3. CSV → Google Sheets 변환
4. 자동화 스크립트가 (1단계: 추출 탭 업데이트):
   - 6개 데이터 시트를 순회
   - `[사업운영팀]_경쟁사_히스토리` 내 탭과 매핑
   - 해당 탭 업데이트
5. 자동화 스크립트가 (1.5단계: 추출 탭 후처리):
   - A열 기업명과 F열(wtd_companyName) 비교 후 조건 충족 시 A열 교체
   - C열 bizno 공란이면 H열(wtd_biz_no) 값으로 보정
6. 자동화 스크립트가 (2단계: Master 탭 날짜 컬럼 갱신):
   - `Master_Meta`의 `last_date_col` 기준으로 새 컬럼 생성
   - 이전 컬럼 수식 → 새 컬럼 복사
   - `Master_Meta`의 `last_date_col`을 다음 컬럼으로 갱신
7. 이전 주 컬럼 값 고정은 수동 처리:
   - `Master_Meta` 기준으로 이전 주 컬럼 선택
   - 시트에서 값으로 붙여넣기(수식 → 값)
8. 결과 로그 작성 및 알림

## 9. 시스템 구성(안)
- GitHub Actions: 스케줄링 및 크롤링 실행
- Google Drive API: 파일 업로드/관리
- Google Sheets API 또는 Apps Script: 탭 매핑 및 업데이트

## 10. 예외 처리
- 입력 데이터 누락: 해당 탭 업데이트 스킵 + 로그
- 탭 미존재: 즉시 실패 후 종료(재시도 없음)
- API 오류: 재시도 3회, 고정 간격 2분
- 데이터 포맷 변경: 스키마 검증 실패 시 중단

## 11. 운영/모니터링
- 실행 로그 저장 위치: (예: GitHub Actions logs, Drive 로그 시트)
- 장애 대응: 수동 재실행 가이드
 - 단계 분리 실행: `extract`(추출 탭) → `master`(Master 탭) 순서로 운영 가능

## 12. 보안/권한
- 서비스 계정 사용 여부
- Drive/Sheets 최소 권한 부여
- 비밀키 관리: GitHub Secrets

## 13. 오픈 이슈/확인 필요
1. 시트 내 함수 의존성(업데이트 후 계산 시간 고려)
2. 미구현 경쟁사 데이터 1건(추후 크롤링 자동화 완료 시 동일 방식으로 추가)
3. 실패 시 재시도 정책(일반 실패 3회, 고정 간격 2분, 탭 미존재는 재시도 없음)
4. `Master_Meta` 운영 규칙(초기 last_date_col 설정 및 자동 갱신 확인)
5. 값 고정(FREEZE) 자동화는 타임아웃 가능성으로 보류

## 14. 일정(초안)
- 요구사항 확정: T+1주
- 개발/검증: T+2~3주
- 시범 운영: T+1주
- 정식 전환: T+1주

## Test Log
- 2026-01-30: Full cycle verified (extract → postprocess chunked → master). Manual freeze remains required.
